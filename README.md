# 待ち行列理論デモ v3 (M/M/c)

本リポジトリは **M/M/c 型待ち行列** (Poisson 到着・指数分布サービス・c 並列サーバ) をブラウザ上で可視化・シミュレーションするシングル HTML デモです。到着率 λ、サービス率 μ、サーバ台数 c をインタラクティブに変更しながら、理論値とシミュレーション結果を比較し、適切なサーバ台数を検討する際の直感的理解を深めることを目的としています。

---

## 特徴

* **ワンクリック実行**： [デモ (GitHub Pages)](https://ikasumi.github.io/queuing_theory_demo/)  をブラウザで開くだけ。外部ライブラリやビルド工程は不要です。
* **リアルタイム可視化**：待機中・処理中・完了の 3 状態を固定配置で表示。最新の進捗が一目で分かります。
* **理論値の自動計算**：M/M/c の主要指標 (利用率 ρ、待ち人数 L<sub>q</sub>、系内人数 L、待ち時間 W<sub>q</sub> など) を数式に基づき即時算出。
* **速度調整 & プリセット**：シミュレーション時間の圧縮倍率や典型的な混雑度 (ρ ≈ 0.5 / 0.9 / ≥1) をワンクリックで切り替え可能。
* **単一ファイル構成**：HTML・CSS・JavaScript を 1 ファイルに同梱。オフライン環境でも動作します。

## クイックスタート

```bash
# リポジトリを取得
git clone https://github.com/ikasumi/queuing_theory_demo.git
cd queuing_theory_demo

# そのままファイルを開く (モダンブラウザ推奨)
open index.html  # macOS の場合
# もしくは簡易 HTTP サーバ経由で
npx http-server -p 8080 .
```

ブラウザで画面を開くと以下の UI が表示されます。

| エリア | 役割 |
| ------ | ---- |
| **Control** | λ, μ, c, 時間圧縮の入力 & 増減ボタン / プリセット / Pause & Reset |
| **Theory**  | M/M/c の理論値をリアルタイム表示 |
| **State View** | 待ち (黄色)・処理中 (緑)・完了 (水色) トークンの状況を描画 |

## パラメータ説明

| 記号 | 意味 | 単位 | 調整方法 |
| ---- | ---- | ---- | ---- |
| λ (lambda) | 到着率 | 人/分 | 数値入力または `±` ボタン、×0.9/×1.1 |
| μ (mu) | サービス率 | 人/分 | 同上 |
| c | サーバ台数 | 台 | `+1/-1` ボタン |
| speed | 時間圧縮倍率 | 倍 | ×0.5 / ×2 など |

### 理論値の式

```text
a = λ / μ
ρ = λ / (c μ)
P₀ = 1 / [ Σₙ₌₀^{c-1} (aⁿ / n!) + (aᶜ / (c! · (1-ρ))) ]
ErlangC = (aᶜ / (c! · (1-ρ))) · P₀
Lq = ErlangC · ρ / (1-ρ)
L  = Lq + a
Wq = Lq / λ
W  = Wq + 1/μ
```

ρ < 1 が安定条件です。目標レベル (例: ρ ≦ 0.7, ErlangC ≦ 5% 等) を決め、c を増減させながら指標を確認してください。

## サーバ台数決定のヒント

1. **利用率 ρ** が 1 に近づくほど待ち時間が指数的に増大します。一般に 0.6〜0.8 程度に抑えると良好な応答時間が得られます。
2. **Erlang C (待ち確率)** や **Lq** を KPI として閾値を設定し、満たす最小の c を選択するのが実務でよく用いられる手法です。
3. コストと SLA のバランスを取りながら、必要最小限のサーバ台数を決定してください。

## 開発者向けメモ

* ES2020 レベルのプレーン JavaScript。依存パッケージなし。

## ライセンス

MIT License

作者: @ikasumi
